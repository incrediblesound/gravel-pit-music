!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{setProp(t){Array.isArray(t.property)?this[t.property[0]][t.property[1]]=t.value:this[t.property]=t.value}}class n{constructor({ctx:t,x:e,y:s,initialValue:i,maxValue:n,cb:o}){this.context=t,this.value=i,this.maxValue=n,this.x=e,this.y=s,this.callback=o}render(){this.context.fillStyle="black",this.context.fillRect(this.x,this.y,40,40),this.context.clearRect(this.x+1,this.y+1,38,38),this.context.fillText("+",this.x+20,this.y+13,40),this.context.fillText("-",this.x+21,this.y+37,40),this.context.fillText(this.value,this.x+5,this.y+25,40)}handleClick(t,e,s,i){const n=Math.floor(i/20);this.value=Math.abs((n?this.value-1:this.value+1)%this.maxValue),this.callback(this.value),this.render()}}class o{constructor(t,e,s,i,o,h,r){this.context=t,this.x=e,this.y=s,this.text=i,this.valueInput=new n({ctx:t,x:e+80,y:s,initialValue:o,maxValue:h,cb:r})}handleClick(t,e,s,i){this.valueInput.handleClick(t,e,s,i)}render(){this.context.fillStyle="black",this.context.fillRect(this.x,this.y,120,40),this.context.clearRect(this.x+1,this.y+1,118,38),this.context.fillText(this.text,this.x+5,this.y+25,80),this.valueInput.render()}}class h extends i{constructor(t){super(),this.volume=8,this.context=t,this.decay=0,this.attack=9,this.config={type:"sine"}}stopAll(){}getOscillators(t){const e=this.context.createOscillator(),s=this.context.createOscillator(),i=this.context.createGain(),n=this.context.createGain();return i.gain.value=.1*this.volume,n.gain.value=.1*(this.volume-(9-this.attack)),e.frequency.value=55,s.frequency.value=440,e.detune.value=100*t,s.detune.value=100*t,e.connect(i),s.connect(n),i.connect(this.context.destination),n.connect(this.context.destination),[e,i,s,n]}play({step:t,note:e}){const[s,i,n,o]=this.getOscillators(e);t&&(s.start(),n.start(),o.gain.setTargetAtTime(.1*this.volume,this.context.currentTime,.01*this.attack),i.gain.setTargetAtTime(0,this.context.currentTime,.07+.01*this.decay),o.gain.setTargetAtTime(0,this.context.currentTime,.1),n.frequency.setTargetAtTime(55,this.context.currentTime,.05),s.stop(this.context.currentTime+1),n.stop(this.context.currentTime+1))}}class r{constructor({options:t,currentValue:e,cb:s,ctx:i,x:n,y:o}){this.context=i,this.idx=void 0!==e?t.indexOf(e):0,this.options=t,this.callBack=s,this.x=n,this.y=o}render(){this.context.fillStyle="black",this.context.fillRect(this.x,this.y,80,40),this.context.clearRect(this.x+1,this.y+1,78,38);const t=this.options[this.idx],e=40-Math.ceil(this.context.measureText(t).width)/2;this.context.fillText(t,this.x+e,this.y+25,39)}handleClick(){this.idx=(this.idx+1)%this.options.length,this.render(),this.callBack(this.options[this.idx])}}class c{constructor(t,e,s,i,n,o,h){this.context=t,this.x=e,this.y=s,this.text=i,this.valueInput=new r({options:n,currentValue:o,cb:h,ctx:t,x:e+80,y:s})}handleClick(t,e,s,i){this.valueInput.handleClick(t,e,s,i)}render(){this.context.fillStyle="black",this.context.fillRect(this.x,this.y,120,40),this.context.clearRect(this.x+1,this.y+1,118,38),this.context.fillText(this.text,this.x+5,this.y+25,80),this.valueInput.render()}}class l extends i{constructor(t){super(),this.volume=8,this.context=t,this.previousTone=0,this.previousOct=1,this.decay=0,this.filterValue=0,this.initialFrequency=0,this.prevOsc=null,this.playing=!1,this.filterType="lowpass",this.Q=0,this.octave=[1,1],this.waveform=["sine","sine"]}stopAll(){this.prevOsc&&(this.prevGainNode.forEach(t=>t.gain.setTargetAtTime(0,this.context.currentTime+.01+.02*this.decay,.05)),this.prevOsc.forEach(t=>t.stop(this.context.currentTime+1)),this.prevOsc=null,this.playing=!1)}getOscillators(t,e,s){this.previousTone=t,this.previousOct=e;const i=this.context.createOscillator();i.detune.value=100*this.previousTone,i.frequency.value=this.previousOct*(440*this.octave[s]),i.type=this.waveform[s];const n=this.context.createGain();n.gain.value=.1*this.volume;const o=this.context.createBiquadFilter();return o.type=this.filterType,o.Q.value=5*this.Q,o.frequency.value=this.initialFrequency?1e3*this.initialFrequency:500,i.connect(o),o.connect(n),n.connect(this.context.destination),[i,n,o]}play({step:t,note:e,hold:s}){if(t&&!s){this.stopAll();const[s,i,n]=this.getOscillators(e,t,0),[o,h,r]=this.getOscillators(e,t,1);this.prevOsc=[s,o],this.prevGainNode=[i,h],s.start(),o.start(),n.frequency.setTargetAtTime(1e3*this.filterValue,this.context.currentTime,.1),r.frequency.setTargetAtTime(1e3*this.filterValue,this.context.currentTime,.1),this.playing=!0}(t&&this.playing||s&&t&&this.playing)&&(this.prevOsc.forEach(t=>t.detune.setTargetAtTime(100*e,this.context.currentTime,.03)),this.prevOsc.forEach(e=>e.frequency.setTargetAtTime(440*t,this.context.currentTime,.03))),!t&&this.prevOsc&&this.stopAll()}}class a extends i{constructor(t){super(),this.name="bass",this.volume=8,this.context=t,this.oscillators={},this.filterValue=1,this.waveform="sawtooth",this.playing=!1}stopAll(){this.oscillators.osc1&&(this.oscillators.gain[0].gain.setTargetAtTime(0,this.context.currentTime+.05,.1),this.oscillators.gain[1].gain.setTargetAtTime(0,this.context.currentTime+.05,.1),this.oscillators.gain[2].gain.setTargetAtTime(0,this.context.currentTime+.05,.1),this.oscillators.osc1.stop(this.context.currentTime+1),this.oscillators.osc2.stop(this.context.currentTime+1),this.oscillators.osc3.stop(this.context.currentTime+1),this.oscillators={},this.playing=!1)}makeOscillator(t){const e=this.context.createOscillator();return e.type=t,e}getOscillators(t,e){const s=this.makeOscillator("triangle"),i=this.makeOscillator(this.waveform),n=this.makeOscillator(this.waveform),o=[this.context.createGain(),this.context.createGain(),this.context.createGain()],h=[this.context.createBiquadFilter(),this.context.createBiquadFilter()];return h[0].frequency.value=500*this.filterValue,h[1].frequency.value=500*this.filterValue,s.connect(o[0]),i.connect(h[0]),n.connect(h[1]),h[0].connect(o[1]),h[1].connect(o[2]),o.forEach(t=>{t.gain.value=.1*this.volume-.05*this.filterValue,t.connect(this.context.destination)}),[s,i,n,o,h]}play({step:t,note:e,hold:s}){if(t&&!s){this.stopAll();let[s,i,n,o,h]=this.getOscillators(e,t);this.oscillators={osc1:s,osc2:i,osc3:n,gain:o,filters:h},h[0].frequency.setTargetAtTime(0,this.context.currentTime+.02,.2),h[1].frequency.setTargetAtTime(0,this.context.currentTime+.02,.2),s.start(),i.start(),n.start(),this.playing=!0}(t&&this.playing||s&&t&&this.playing&&this.oscillators.osc1)&&(this.oscillators.osc1.frequency.value=55*t,this.oscillators.osc2.frequency.value=55*t,this.oscillators.osc3.frequency.value=110*t,this.oscillators.osc1.detune.value=99*e,this.oscillators.osc2.detune.value=101*e,this.oscillators.osc3.detune.value=100*e),t||this.stopAll()}}const u={parallel:"setupOscillators_A",vertical:"setupOscillators_B"};class p extends i{constructor(t){super(),this.volume=8,this.mod1Oct=0,this.mod2Oct=0,this.context=t,this.decay=1,this.prevOsc=null,this.oscillators={},this.playing=!1,this.waveformOptions=["square","sine","sawtooth"],this.waveform="square",this.fmMode="parallel"}storeOscillators(t){Object.keys(t).forEach(e=>{this.oscillators[e]=t[e]})}stopAll(){this.oscillators.osc1&&(this.oscillators.gainNode1.gain.setTargetAtTime(0,this.context.currentTime+.01*this.decay,.05),this.oscillators.gainNode2.gain.setTargetAtTime(0,this.context.currentTime+.01*this.decay,.05),this.oscillators.osc1.stop(this.context.currentTime+1),this.oscillators.osc2.stop(this.context.currentTime+1),this.oscillators.modulator1.stop(this.context.currentTime+1),this.oscillators.modulator2.stop(this.context.currentTime+1),this.oscillators.modulatorA.stop(this.context.currentTime+1),this.oscillators.modulatorB.stop(this.context.currentTime+1),this.oscillators={},this.playing=!1)}getModulator(t,e,s){const i=this.context.createOscillator(),n=this.context.createGain();return i.type=e,i.frequency.value=t,n.gain.value=s,i.connect(n),[i,n]}getOscillator(t){const e=this.context.createOscillator();e.type=this.waveform;const s=this.context.createGain();s.gain.value=.02*this.volume;const i=this.context.createStereoPanner();let n=0;"left"===t&&(n=-.7),"right"===t&&(n=.7),i.pan.value=n;const o=this.context.createBiquadFilter();return o.type="lowpass",o.frequency.value=0,e.connect(o),o.connect(s),s.connect(i),i.connect(this.context.destination),[e,o,s]}setupOscillators_A(){const[t,e,s]=this.getOscillator("left"),[i,n,o]=this.getOscillator("right"),[h,r]=this.getModulator(5*this.mod1Oct*5.5,"sawtooth",70),[c,l]=this.getModulator(10*this.mod2Oct*5.5,"sine",90),[a,u]=this.getModulator(5*this.mod1Oct*5.5,"sawtooth",50),[p,x]=this.getModulator(10*this.mod2Oct*5.5,"sine",40);return r.connect(a.frequency),l.connect(p.frequency),u.connect(t.frequency),x.connect(i.frequency),[t,i,s,o,h,c,a,p,e,n]}setupOscillators_B(){const[t,e,s]=this.getOscillator(),[i,n,o]=this.getOscillator(),[h,r]=this.getModulator(5*this.mod1Oct*5.5,"square",35),[c,l]=this.getModulator(10*this.mod2Oct*5.5,"sine",50),[a,u]=this.getModulator(5*this.mod1Oct*5.5,"sine",30),[p,x]=this.getModulator(10*this.mod2Oct*5.5,"sine",35);return r.connect(a.frequency),u.connect(c.frequency),l.connect(t.frequency),s.connect(i.frequency),[t,i,s,o,h,c,a,p,e,n]}play({step:t,note:e,hold:s}){if(t&&!s){this.stopAll();const s=u[this.fmMode],[i,n,o,h,r,c,l,a,p,x]=this[s](e,t);this.storeOscillators({osc1:i,osc2:n,modulatorA:r,modulatorB:c,modulator1:l,modulator2:a,gainNode1:o,gainNode2:h}),r.start(),c.start(),l.start(),a.start(),i.start(),n.start(),p.frequency.setTargetAtTime(5e3,this.context.currentTime,.03),x.frequency.setTargetAtTime(5e3,this.context.currentTime,.03),this.playing=!0}(t&&this.playing||s&&t&&this.playing)&&(this.oscillators.osc1.detune.value=101*e,this.oscillators.osc1.frequency.value=220*t,this.oscillators.osc2.detune.value=99*e,this.oscillators.osc2.frequency.value=220*t),!t&&this.oscillators.osc1&&this.stopAll()}}class x extends i{constructor(t){super(),this.volume=8,this.context=t,this.config={type:"triangle"},this.buffer=function(t){const e=t.sampleRate,s=t.createBuffer(1,e,t.sampleRate),i=s.getChannelData(0);for(var n=0;n<e;n++)i[n]=2*Math.random()-1;return s}(t)}setVolume(t){this.volume=t}stopAll(){}getNoise(){const t=this.context.createBufferSource();t.buffer=this.buffer;const e=this.context.createBiquadFilter();e.type="highpass",e.frequency.value=1e3;const s=this.context.createGain();return s.gain.value=.1*this.volume,t.connect(e),e.connect(s),s.connect(this.context.destination),[t,s]}getOscillators(){const t=this.context.createOscillator();t.type=this.config.type,t.frequency.value=150;const e=this.context.createGain();return e.gain.value=.1*this.volume,t.connect(e),e.connect(this.context.destination),[t,e]}play({step:t}){if(t){const[t,e]=this.getOscillators(),[s,i]=this.getNoise();t.start(),s.start(),e.gain.setTargetAtTime(0,this.context.currentTime,.04),i.gain.setTargetAtTime(0,this.context.currentTime,.03),t.stop(this.context.currentTime+.3),s.stop(this.context.currentTime+.3)}}}class d extends i{constructor(t){super(),this.volume=8,this.context=t,this.prevOsc=null,this.buffer=function(t){const e=t.sampleRate,s=t.createBuffer(1,e,t.sampleRate),i=s.getChannelData(0);for(var n=0;n<e;n++)i[n]=2*Math.random()-1;return s}(t)}getNoise(){const t=this.context.createBufferSource();t.buffer=this.buffer;const e=this.context.createBiquadFilter();e.type="highpass",e.frequency.value=2500,t.connect(e);const s=this.context.createGain();return s.gain.value=.1*this.volume,e.connect(s),s.connect(this.context.destination),[t,s]}stopAll(){this.prevOsc&&this.prevOsc.stop(0)}play({step:t}){if(t){this.stopAll();const e=1===t?.01:.05,[s,i]=this.getNoise();this.prevOsc=s,s.start(0),i.gain.setTargetAtTime(0,this.context.currentTime,e),s.stop(this.context.currentTime+.3)}}}const m="white",y=16,f=4;function g(t){let e=[];return e.length=t,e.fill(void 0),e.map(t=>({step:0,note:0,hold:!1}))}class v{constructor(t,e,s,i,n){this.context=e,this.word=t,this.x=s,this.y=i,this.handleClick=n||function(){}}render(){this.context.clearRect(this.x,this.y,40,40),this.context.fillStyle="green",this.context.fillText(this.word,this.x+3,this.y+25,80)}}class w{constructor(t,e,s,i,n){this.x=s,this.y=i,this.text=t,this.textWidth=Math.ceil(e.measureText(t).width),this.width=40*Math.ceil((this.textWidth+10)/40),this.toggled=!1,this.context=e,this.callBack=n}handleClick(t,e){this.toggled=!this.toggled,this.callBack(this.toggled),this.render()}render(){this.context.clearRect(this.x,this.y,this.width,40),this.context.fillStyle="black",this.context.fillRect(this.x,this.y,this.width,40),(this.isToggled?this.isToggled():this.toggled)?(this.context.fillStyle="#999",this.context.fillRect(this.x+1,this.y,this.width-2,39)):this.context.clearRect(this.x+1,this.y+1,this.width-2,39),this.context.fillStyle="black";const t=this.width/2-this.textWidth/2;this.context.fillText(this.text,this.x+t,this.y+25,this.width+3)}}class T{constructor(t,e,s,i,n){this.idx=t,this.state=e,this.context=s,this.x=i,this.y=n,this.colors=["black","red","blue"]}render(){const t=this.state.getPage();this.context.fillStyle=this.colors[t[this.idx].step],this.context.fillRect(this.x,this.y,39,39),this.context.fillStyle=t[this.idx].hold?"green":"yellow",this.context.fillRect(this.x,this.y,10,10),this.context.fillStyle=m}handleClick(t,e,s,i){const n=s<=10&&i<=10,o=this.state.getPage();n?o[this.idx].hold=!o[this.idx].hold:(this.value=(o[this.idx].step+1)%3,o[this.idx].step=this.value),this.context.clearRect(this.x,this.y,39,39),this.render()}}class k{constructor(t,e,s,i,n){this.context=s,e.blinkers[t]=this,this.idx=t,this.on=!1,this.x=i,this.y=n}render(){this.on||this.idx%4==0?this.drawCircle():this.context.clearRect(this.x-1,this.y-1,39,39)}drawCircle(){this.context.beginPath(),this.context.arc(this.x+20,this.y+20,8,0,2*Math.PI,!1),this.context.fillStyle=this.idx%4?"red":"blue",this.context.fill(),this.context.lineWidth=1,this.context.strokeStyle="#003300",this.context.stroke()}handleClick(){}toggle(t){this.on=void 0!==t?t:!this.on,this.render()}}class b{constructor(t,e,s,i,n){this.notes=["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"],this.parent=e,this.context=s,this.idx=t,this.x=i,this.y=n}render(){this.context.fillStyle="black",this.context.fillRect(this.x,this.y,40,40),this.context.clearRect(this.x+1,this.y+1,38,38);const t=this.parent.getPage()[this.idx].note;this.context.fillText(this.notes[t],this.x+15,this.y+25,15)}handleClick(){const t=this.parent.getPage();t[this.idx].note=11===t[this.idx].note?0:t[this.idx].note+1,this.render()}}var O={bass:(t,e,s,i,n,h)=>{const r=t.instruments.bass.volume,l=new o(i,n,h,"Volume",r,10,e=>{t.instruments.bass.setProp({property:"volume",value:e})});e.push(l),s["0/0"]=l,s["1/0"]=l,s["2/0"]=l;const a=t.instruments.bass.filterValue,u=new o(i,n+120,h,"Filter",a,20,e=>{t.instruments.bass.setProp({property:"filterValue",value:e})});e.push(u),s["3/0"]=u,s["4/0"]=u,s["5/0"]=u;const p=new c(i,n+280,h,"Waveform",["triangle","square","sawtooth"],t.instruments.bass.waveform,e=>{t.instruments.bass.setProp({property:"waveform",value:e})});e.push(p),s["7/0"]=p,s["8/0"]=p,s["9/0"]=p,s["10/0"]=p},lead:(t,e,s,i,n,h)=>{const r=t.instruments.lead.volume,l=new o(i,n,h,"Volume",r,10,e=>{t.instruments.lead.setProp({property:"volume",value:e})});e.push(l),s["0/0"]=l,s["1/0"]=l,s["2/0"]=l;const a=new c(i,n+160,h,"Waveform 1",["square","sine","sawtooth"],t.instruments.lead.waveform[0],e=>{t.instruments.lead.setProp({property:["waveform",0],value:e})});e.push(a),s["4/0"]=a,s["5/0"]=a,s["6/0"]=a,s["7/0"]=a;const u=new c(i,n+160,h+40,"Waveform 2",["square","sine","sawtooth"],t.instruments.lead.waveform[1],e=>{t.instruments.lead.setProp({property:["waveform",1],value:e})});e.push(u),s["4/1"]=u,s["5/1"]=u,s["6/1"]=u,s["7/1"]=u;const p=new c(i,n,h+40,"Octave 1",[.125,.25,.5,1,2],t.instruments.lead.octave[0],e=>{t.instruments.lead.setProp({property:["octave",0],value:e})});e.push(p),s["0/1"]=p,s["1/1"]=p,s["2/1"]=p,s["3/1"]=p;const x=new c(i,n,h+80,"Octave 2",[.125,.25,.5,1,2],t.instruments.lead.octave[1],e=>{t.instruments.lead.setProp({property:["octave",1],value:e})});e.push(x),s["0/2"]=x,s["1/2"]=x,s["2/2"]=x,s["3/2"]=x;const d=t.instruments.lead.filterValue,m=new o(i,n+400,h,"Filter End",d,10,e=>{t.instruments.lead.setProp({property:"filterValue",value:e})});e.push(m),s["10/0"]=m,s["11/0"]=m,s["12/0"]=m;const y=t.instruments.lead.initialFrequency,f=new o(i,n+320,h,"Filter Start",y,10,e=>{t.instruments.lead.setProp({property:"initialFrequency",value:e})});e.push(f),s["8/0"]=f,s["9/0"]=f,s["10/0"]=f;const g=new c(i,n+440,h+40,"Filter Type",["lowpass","highpass","bandpass","notch"],t.instruments.lead.filterType,e=>{t.instruments.lead.setProp({property:"filterType",value:e})});e.push(g),s["11/1"]=g,s["12/1"]=g,s["13/1"]=g,s["14/1"]=g;const v=t.instruments.lead.Q,w=new o(i,n+320,h+40,"Filter Q",v,10,e=>{t.instruments.lead.setProp({property:"Q",value:e})});e.push(w),s["8/1"]=w,s["9/1"]=w,s["10/1"]=w},fm:(t,e,s,i,n,h)=>{const r=t.instruments.fm.volume,l=new o(i,n,h,"Volume",r,10,e=>{t.instruments.fm.setProp({property:"volume",value:e})});e.push(l),s["0/0"]=l,s["1/0"]=l,s["2/0"]=l;const a=t.instruments.fm.decay,u=new o(i,n,h+40,"Decay",a,9,e=>{0===e&&(e+=1),t.instruments.fm.setProp({property:"decay",value:e})});e.push(u),s["0/1"]=u,s["1/1"]=u,s["2/1"]=u;const p=new c(i,n+120,h,"Waveform",["square","sine","sawtooth"],t.instruments.fm.waveform,e=>{t.instruments.fm.setProp({property:"waveform",value:e})});e.push(p),s["3/0"]=p,s["4/0"]=p,s["5/0"]=p,s["6/0"]=p;const x=new c(i,n+120,h+40,"FM Mode",["vertical","parallel"],t.instruments.fm.fmMode,e=>{t.instruments.fm.setProp({property:"fmMode",value:e})});e.push(x),s["3/1"]=x,s["4/1"]=x,s["5/1"]=x,s["6/1"]=x;const d=t.instruments.fm.mod1Oct,m=new o(i,n+280,h,"Mod1 Oct",d,5,e=>{t.instruments.fm.setProp({property:"mod1Oct",value:e})});e.push(m),s["7/0"]=m,s["8/0"]=m,s["9/0"]=m;const y=t.instruments.fm.mod2Oct,f=new o(i,n+280,h+40,"Mod2 Oct",y,5,e=>{t.instruments.fm.setProp({property:"mod2Oct",value:e})});e.push(f),s["7/1"]=f,s["8/1"]=f,s["9/1"]=f},kick:(t,e,s,i,n,h)=>{const r=t.instruments.kick.volume,c=new o(i,n,h,"Volume",r,10,e=>{t.instruments.kick.setProp({property:"volume",value:e})});e.push(c),s["0/0"]=c,s["1/0"]=c,s["2/0"]=c;const l=t.instruments.kick.attack,a=new o(i,n,h+40,"Attack",l,10,e=>{t.instruments.kick.setProp({property:"attack",value:e})});e.push(a),s["0/1"]=a,s["1/1"]=a,s["2/1"]=a},hat:(t,e,s,i,n,h)=>{const r=t.instruments.hat.volume,c=new o(i,n,h,"Volume",r,10,e=>{t.instruments.hat.setProp({property:"volume",value:e})});e.push(c),s["0/0"]=c,s["1/0"]=c,s["2/0"]=c},snare:(t,e,s,i,n,h)=>{const r=t.instruments.snare.volume,c=new o(i,n,h,"Volume",r,10,e=>{t.instruments.snare.setProp({property:"volume",value:e})});e.push(c),s["0/0"]=c,s["1/0"]=c,s["2/0"]=c}};const P=document.getElementById("synth"),q=P.getContext("2d");q.font="14px sans-serif";const A=new class{constructor(t){this.swingIsOn=!1,this.isPlaying=!1,this.tempo=120,this.viewPage=0,this.playPage=0,this.sequenceIndex=0,this.sequence=[0,0,0,0],this.blocks={},this.blinkers=[],this.children=[],this.steps={bass:[g(16),g(16),g(16),g(16)],kick:[g(16),g(16),g(16),g(16)],snare:[g(16),g(16),g(16),g(16)],lead:[g(16),g(16),g(16),g(16)],fm:[g(16),g(16),g(16),g(16)],hat:[g(16),g(16),g(16),g(16)]},this.copyBuffer={notes:{},steps:{}},this.step=0,this.context=t,this.instruments={bass:new a(t),kick:new h(t),snare:new x(t),fm:new p(t),lead:new l(t),hat:new d(t)}}push(t){return this.children.push(t),t}trigger(t){switch(t.type){case"get_page":return this.steps[t.instrument][this.viewPage];case"toggle_swing":return this.swingIsOn=!this.swingIsOn;case"set_page":return this.viewPage=t.page,this.drawScreen(),t.page;case"copy_page":return this.copyPage();case"paste_page":return this.pastePage();case"set_sequence":return this.setSequence(t.sequence)}}toggleStep(t,e,s){this.steps[e][this.viewPage][t].step=(this.steps[e][this.viewPage][t].step+1)%s}togglePlay(){if(this.isPlaying=!this.isPlaying,!this.isPlaying)return this.stop();this.context.resume().then(()=>(this.noteTime=0,this.startTime=this.context.currentTime+.005,this.rhythmIndex=0,this.previousRhythmIndex=null,this.schedule()))}setSequence(t){this.sequence=t}copyPage(){Object.keys(this.steps).forEach(t=>{this.copyBuffer.steps[t]=this.steps[t][this.viewPage].slice().map(t=>Object.assign({},t))})}pastePage(){Object.keys(this.steps).forEach(t=>{this.steps[t][this.viewPage]=this.copyBuffer.steps[t].slice()}),this.drawScreen()}schedule(){let t=this.context.currentTime;const e=.2+(t-=this.startTime);for(;this.noteTime<e;)this.noteTime,this.startTime,this.viewPage===this.playPage&&this.blinkers[this.rhythmIndex].toggle(),null!==this.previousRhythmIndex&&this.blinkers[this.previousRhythmIndex].toggle(!1),Object.keys(this.steps).forEach(t=>{this.instruments[t].play(this.steps[t][this.playPage][this.rhythmIndex])}),this.advanceNote();this.interval=setTimeout(()=>{this.schedule()},0)}advanceNote(){let t=60/this.tempo;this.previousRhythmIndex=this.rhythmIndex,this.rhythmIndex++,this.rhythmIndex===y&&(this.rhythmIndex=0,this.sequenceIndex=(this.sequenceIndex+1)%f,this.playPage=this.sequence[this.sequenceIndex],this.drawScreen()),this.swingIsOn?this.noteTime+=this.rhythmIndex%2?.32*t:.18*t:this.noteTime+=.25*t}stop(){Object.keys(this.instruments).forEach(t=>{this.instruments[t].stopAll()}),this.blinkers[this.previousRhythmIndex].toggle(),window.clearInterval(this.interval),this.context.suspend()}drawScreen(){this.children.forEach(t=>t.render())}}(new(window.AudioContext||window.webkitAudioContext)),M=A.push(new class{constructor(t,e,s,i){this.context=t,this.state=e,this.x=s,this.y=i,this.on=e.isPlaying}render(){this.on=this.state.isPlaying,this.context.fillStyle=this.on?"red":"green",this.context.fillRect(this.x,this.y,40,40),this.context.fillStyle=this.on?"black":"white",this.context.fillText(this.on?"STOP":"PLAY",this.x+1,this.y+25,80)}handleClick(){this.state.togglePlay(),this.on=this.state.isPlaying,this.render()}}(q,A,0,0));A.blocks["0/0"]=M;const S=A.push(new class{constructor(t,e,s,i,n){this.context=e,this.state=t,this.pageOne=s/40,this.x=s,this.y=i,this.value=0,this.callBack=n}handleClick(t,e){const s=t-this.pageOne;this.value=s,this.state.trigger({type:"set_page",page:this.value}),this.render()}render(){this.value=this.state.viewPage,this.context.fillStyle="black";for(let t=0;t<4;t++){const e=40*t,s=`Pg ${t+1}`;this.context.fillRect(this.x+e,this.y,40,40),t===this.value?(this.context.fillStyle="#999",this.context.fillRect(this.x+e+1,this.y,39-(3===t?1:0),39)):this.context.clearRect(this.x+e+1,this.y,39-(3===t?1:0),39),this.context.fillStyle="black",this.context.fillText(s,this.x+e+3,this.y+25,80)}}}(A,q,80,0));A.blocks["2/0"]=S,A.blocks["3/0"]=S,A.blocks["4/0"]=S,A.blocks["5/0"]=S;const R=A.push(new class{constructor(t,e,s,i,n){this.context=e,this.state=t,this.pageOne=s/40,this.x=s,this.y=i,this.value=[0,0,0,0],this.callBack=n}handleClick(t,e){const s=t-this.pageOne;this.value[s]=(this.value[s]+1)%4,this.state.trigger({type:"set_sequence",sequence:this.value}),this.render()}render(){this.context.clearRect(this.x,this.y,40,160),this.context.fillStyle="black";for(let t=0;t<4;t++){const e=40*t,s=`${this.value[t]+1}`;this.context.fillRect(this.x+e,this.y,40,40),this.context.clearRect(this.x+e+1,this.y,39-(3===t?1:0),39),this.state.sequenceIndex===t&&(this.context.beginPath(),this.context.arc(this.x+40*t+6,this.y+6,4,0,2*Math.PI,!1),this.context.fillStyle="blue",this.context.fill()),this.context.fillStyle="black",this.context.fillText(s,this.x+e+17,this.y+25,80)}}}(A,q,80,40));A.blocks["2/1"]=R,A.blocks["3/1"]=R,A.blocks["4/1"]=R,A.blocks["5/1"]=R,A.blocks["7/0"]=A.push(new v("Copy",q,280,0,()=>A.trigger({type:"copy_page"}))),A.blocks["8/0"]=A.push(new v("Paste",q,320,0,()=>A.trigger({type:"paste_page"})));const C=A.push(new class{constructor(t,e,s,i){this.context=e,this.state=t,this.x=s,this.y=i}render(){const t=`${this.state.tempo}/bpms`;this.context.fillStyle="black",this.context.clearRect(this.x,this.y,65,40),this.context.fillText("+",this.x+25,this.y+10,80),this.context.fillText("-",this.x+26,this.y+40,80),this.context.fillText(t,this.x,this.y+25,80)}handleClick(t,e,s,i){const n=Math.floor(i/20);this.state.tempo=n?this.state.tempo-1:this.state.tempo+1,this.render()}}(A,q,440,0));A.blocks["11/0"]=C,A.blocks["12/0"]=C;const I=A.push(new r({options:["straight","swing"],cb:()=>A.trigger({type:"toggle_swing"}),ctx:q,x:560,y:0}));A.blocks["14/0"]=I,A.blocks["15/0"]=I;const B=A.push(new class{constructor(t,e,s,i){this.x=s,this.y=i,this.parent=t,this.context=e,this.instrument="bass",this.instrumentControlMap={},this.moduleMap={},this.children=[],this.instrumentControls=[],this.build()}push(t){return this.children.push(t),t}build(){for(var t=0;t<16;t++)this.moduleMap[`${t}/9`]=this.push(new b(t,this,this.context,this.x+40*t,this.y+360)),this.moduleMap[`${t}/10`]=this.push(new T(t,this,this.context,this.x+40*t,this.y+400)),this.moduleMap[`${t}/11`]=this.push(new k(t,this.parent,this.context,this.x+40*t,this.y+440));this.buildInstrumentControls()}buildInstrumentControls(){O[this.instrument](this.parent,this.instrumentControls,this.instrumentControlMap,this.context,this.x,this.y)}trigger(t){return this.parent.trigger(t)}setInstrument(t){this.instrument=t,this.instrumentControls=[],this.instrumentControlMap={},this.build(),this.parent.drawScreen()}getPage(){return this.trigger({type:"get_page",instrument:this.instrument})}renderChildren(){this.children.forEach(t=>t.render()),this.instrumentControls.forEach(t=>t.render())}render(){this.context.fillRect(this.x,this.y,640,480),this.context.clearRect(this.x+1,this.y+1,638,478),this.renderChildren()}handleClick(t,e,s,i){let n=`${t-this.x/40}/${e-this.y/40}`,o=this.moduleMap[n]||this.instrumentControlMap[n];o&&o.handleClick(t,e,s,i)}}(A,q,160,120));for(let t=4;t<20;t++)for(let e=3;e<16;e++)A.blocks[`${t}/${e}`]=B;const V=["fm","bass","lead","kick","snare","hat"];let _=160;for(let t=0;t<V.length;t++){let e=new w(V[t],q,_,80,e=>{B.setInstrument(V[t])});e.isToggled=()=>B.instrument===V[t],A.push(e);for(let t=0;t<=Math.floor(e.width/40);t++)A.blocks[`${Math.ceil(_/40)+t}/2`]=e;_+=e.width}P.onclick=function(t){let e=0,s=0,i=0,n=0,o=this;do{e+=o.offsetLeft-o.scrollLeft,s+=o.offsetTop-o.scrollTop}while(o=o.offsetParent);i=t.pageX-e-window.scrollX,n=t.pageY-s-window.scrollY;let h=Math.floor(i/40),r=Math.floor(n/40),c=i-40*h,l=n-40*r;const a=`${h}/${r}`;A.blocks[a]&&A.blocks[a].handleClick(h,r,c,l)};const F=["Digit1","Digit2","Digit3","Digit4"];window.onkeydown=function(t){if(t.code)if("Space"===t.code)A.togglePlay(),M.render();else if(-1!==F.indexOf(t.code)){const e=parseInt(t.code.split("Digit")[1])-1;A.trigger({type:"set_page",page:e})}else if("BracketLeft"===t.code||"BracketRight"===t.code){let e=V.indexOf(B.instrument);"BracketLeft"===t.code&&e>0&&(e-=1),"BracketRight"===t.code&&e<V.length-1&&(e+=1),B.setInstrument(V[e])}else"KeyC"===t.code?A.trigger({type:"copy_page"}):"KeyV"===t.code&&A.trigger({type:"paste_page"})},A.drawScreen()}]);
//# sourceMappingURL=main.bundle.js.map